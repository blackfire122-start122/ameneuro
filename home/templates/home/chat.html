{% extends 'home/shablons/base.html' %}
{% load static %}

{% block title %}Chat{% endblock title %}

{% block content_header %}
	<link rel="stylesheet" href="{% static 'home/css/chat.css' %}">
	<h4 class="userregname">
		{% for n in chat.users.all %}
			{% if n != user %}
				{{ n }}
			{% endif %}
		{% endfor %}
	</h4>
	<div>
		<img src="{% static 'home/images/music.png' %}" class="music_btn" onclick="music_show()"></img>
		<div class="musics"></div>
	</div>
	<div class="opt_mus">
		<img onclick="chat_options(this)" class='img_opt' src="{% static 'home/images/options.png' %}">
	</div>
{% endblock content_header %}

{% block content %}	
	<div class="messages">
		{% for m in messages %}
			{% if m.type_m == 'msg' %}
				{% if m.user == user %}
					<div class="my_msgs">
						<p class="mes">{{ m }}</p>
						<time class='time'>{{ m.date }}</time>
					</div>
				{% else %}
					<div class="other_msgs">
						<p class="mes">{{ m }}</p>
						<time class='time'>{{ m.date }}</time>
					</div>
				{% endif %}

			{% elif m.type_m == 'new_theme' %}
				<div class="new_theme">
					<p class="mes">{{ m }}</p>
				</div>
			{% elif m.type_m == 'file' %}
				{% if m.user == user %}
					<div class="my_msgs">
						<img class="img_file_mes" src="{{ m.file.url }}" alt="">
						<p class="mes">{{ m }}</p>
						<time class='time'>{{ m.date }}</time>
					</div>
				{% else %}
					<div class="other_msgs">
						<img class="img_file_mes" src="{{ m.file.url }}" alt="">
						<p class="mes">{{ m }}</p>
						<time class='time'>{{ m.date }}</time>
					</div>
				{% endif %}
			{% endif %}
		{% endfor %}
	</div>
	{% with end_mes=messages|last %}
		{% if end_mes.readeble %}
			<span class='readeble'>Read</span>
		{% else %}
			<span class='readeble'>not read</span>
		{% endif %} 
	{% endwith %}

	<span id="error"> {{ error }} </span>
	
	<div class="input_mes_send">
		<input onkeydown="inp_msg_user(this)" placeholder='message' id="msg_user" type="text">
		<div class="send_file">
			<button id="btn_send" onclick="btn_send()">Send</button>
			<img onclick="send_file_mes()" class="file_img" src="{% static 'home/images/file.png' %}" alt="">
		</div>
	</div>
	<div class="options"></div>
	<div class="file_mes_form"></div>
<!-- 	<div class="click_mus" onclick="click_mus(this)">
		<h1 class="text_for_click">Click for music play</h1>
	</div> -->

	<script>
		let user = "{{ user }}"
		let chat = "{{ chat }}"
		let chat_id = "{{ chat.id }}"
		let chat_options_ajax = "{% url 'chat_options_ajax' %}"
		let bg_inp_val = "{{ chat.theme.color_mes_bg }}"
		let chat_get_mess_ajax = "{% url 'chat_get_mess_ajax' %}"
		let send_file_mes_ajax = "{% url 'send_file_mes_ajax' %}"

	</script>
	<script src="{% static 'home/js/jquery-3.6.0.min.js' %}"></script>
	<script src="{% static 'home/js/chat.js' %}"></script>
	<style>
		body{
			background-image: url("{{ chat.theme.background.url }}");
			background-size: cover;
			background-repeat: round;
			background-attachment: fixed;
		}
		.messages{
			color: {{ chat.theme.color_mes }};
		}
		.my_msgs, .other_msgs{
			background: rgba({{ chat.theme.color_mes_bg }});
		}
	</style>
{% endblock content %}